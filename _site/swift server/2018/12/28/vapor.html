<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>First step with Vapor | Jonathan Seguin</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="First step with Vapor" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I recently had the oportunity to test Vapor. It is one of the most used a Swift Web Framework that used SwiftNIO. Actually in version 3.1.0, it is compatible with macOS and Ubuntu. They have made a lot of change for this new version, and they almost totally re-write or update the documentation, which is now very good (it was one of the main issue of the previouses versions)." />
<meta property="og:description" content="I recently had the oportunity to test Vapor. It is one of the most used a Swift Web Framework that used SwiftNIO. Actually in version 3.1.0, it is compatible with macOS and Ubuntu. They have made a lot of change for this new version, and they almost totally re-write or update the documentation, which is now very good (it was one of the main issue of the previouses versions)." />
<link rel="canonical" href="/swift%20server/2018/12/28/vapor.html" />
<meta property="og:url" content="/swift%20server/2018/12/28/vapor.html" />
<meta property="og:site_name" content="Jonathan Seguin" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-12-28T12:22:00+01:00" />
<script type="application/ld+json">
{"description":"I recently had the oportunity to test Vapor. It is one of the most used a Swift Web Framework that used SwiftNIO. Actually in version 3.1.0, it is compatible with macOS and Ubuntu. They have made a lot of change for this new version, and they almost totally re-write or update the documentation, which is now very good (it was one of the main issue of the previouses versions).","@type":"BlogPosting","url":"/swift%20server/2018/12/28/vapor.html","headline":"First step with Vapor","dateModified":"2018-12-28T12:22:00+01:00","datePublished":"2018-12-28T12:22:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"/swift%20server/2018/12/28/vapor.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Jonathan Seguin" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Jonathan Seguin</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">First step with Vapor</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2018-12-28T12:22:00+01:00" itemprop="datePublished">Dec 28, 2018
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>I recently had the oportunity to test Vapor.
It is one of the most used a <strong>Swift Web Framework</strong> that used SwiftNIO. 
Actually in version 3.1.0, it is compatible with macOS and Ubuntu. They have made a lot of change for this new version, and they almost totally re-write or update the documentation, which is now very good (it was one of the main issue of the previouses versions).</p>

<p><img src="/assets/vapor.png" alt="Vapor logo" title="Vapor logo" style="display: block; margin-left: auto; margin-right: auto; width: 50%;" /></p>

<h3 id="setup">Setup</h3>

<p>After building a test project and testing some functionalities, one thing I can say is it is very easy and fast to create an API with Vapor. 
So I think it is maybe the best entrance door for iOS developers who need to make an API and want to use the same language than their apps for their server. It also can be used for some quick prototypes, for example.
And it seems that it is more and more used in production, as I can’t compare with others servers technologies because I am not really an expert on this subject. But as an iOS developer, I can see the advantages of the usage of Vapor to build a server for my apps :</p>

<ul>
  <li>We can share some classes.</li>
  <li>We don’t have to care about JSON parsing, thanks to <code class="highlighter-rouge">Codable</code> available since version 3.0.</li>
</ul>

<p>So here it is. All my tests were done on macOS.
You can install vapor using Homebrew :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew install vapor/tap/vapor
</code></pre></div></div>

<p>Of course, it will require Swift at least to be installed on your Mac. I suggest you have Xcode to be installed to.</p>

<p>After that, use these commands :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Create an project with base classes and some example code
vapor new ProjectName

// Make it an Xcode project 
<span class="nb">cd </span>ProjectName
vapor xcode
</code></pre></div></div>

<p>It generates a ready-to-start example project with an <code class="highlighter-rouge">.xcodeproj</code>file that you can easily open from Xcode.</p>

<p>This project contains :</p>

<ul>
  <li>An SQLite database.</li>
  <li>A Fluent model and its associated Controller.</li>
  <li>Some routing examples in <code class="highlighter-rouge">routes.swift</code> file.</li>
  <li>The file <code class="highlighter-rouge">configure.swift</code> contains all the settings and the services that will be used in the Application.</li>
  <li>The <code class="highlighter-rouge">boot.swift</code> file is empty, but should be used for all the setup that need to be done after the Application has initialized.</li>
  <li>Because it used <a href="https://swift.org/package-manager/">Swift Package Manager</a>, there is a <code class="highlighter-rouge">Package.swift</code> file.</li>
</ul>

<p>With all this, you can already run th <code class="highlighter-rouge">Run</code> target on Xcode and start testing the routes listed in <code class="highlighter-rouge">routes.swift</code>, using <code class="highlighter-rouge">http://localhost:8080</code> as root url, it works !</p>

<h3 id="functionalities">Functionalities</h3>

<p>I list here what I think to be the main advantages to use Vapor instead of an other server technology. Most of them have been added on version 3.0.</p>

<ul>
  <li>
    <p>It used a dependency injection framework called the <strong>Services</strong>. Databases, middlewares, providers and even router are all services of the Vapor application. So if you prefer to use PostgreSQL instead of SQLite for example, it’s easy to replace.</p>
  </li>
  <li>
    <p>Since 3.0, Vapor works on a <strong>asynchronous system</strong>. It is possible because of the usage of the Swift language. On each core of the CPU it is running on, will be associated an <em>event loop</em>. All communication between clients and server will happen on the event loop the client has been associated with. Vapor can handle multiple requests on each event loop asynchronously. To interact with the event loop, we use <code class="highlighter-rouge">Workers</code>, and the most commons that you will use with Vapor are <code class="highlighter-rouge">Application</code>, <code class="highlighter-rouge">Request</code> and <code class="highlighter-rouge">Response</code>. That’s why there is a critical rule to respect : never make blocking call on an event loop. For that we need to use <code class="highlighter-rouge">Future</code> and <code class="highlighter-rouge">Promise</code>, already implemented in Vapor base package.</p>
  </li>
  <li>
    <p>The <strong>Controllers</strong> are used to <em>delegate</em> the operations asked by a routing request, and return a result. I should take a <code class="highlighter-rouge">Request</code> object as a parameter, and it will generally return a result inside a <code class="highlighter-rouge">Future</code>.</p>
  </li>
</ul>

<p>Example :</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">final</span> <span class="kd">class</span> <span class="kt">HelloController</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">greet</span><span class="p">(</span><span class="n">_</span> <span class="nv">req</span><span class="p">:</span> <span class="kt">Request</span><span class="p">)</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">"Hello world!"</span>
    <span class="p">}</span>
    
    <span class="c1">// Wait for an encoded Hello on the content request and save it on DB</span>
    <span class="kd">func</span> <span class="nf">create</span><span class="p">(</span><span class="n">_</span> <span class="nv">req</span><span class="p">:</span> <span class="kt">Request</span><span class="p">)</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">Future</span><span class="o">&lt;</span><span class="kt">Hello</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">try</span> <span class="n">req</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Hello</span><span class="o">.</span><span class="k">self</span><span class="p">)</span><span class="o">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">hello</span> <span class="k">in</span>
            <span class="k">return</span> <span class="n">hello</span><span class="o">.</span><span class="nf">save</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="n">req</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And in our <code class="highlighter-rouge">routes.swift</code> :</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">func</span> <span class="nf">routes</span><span class="p">(</span><span class="n">_</span> <span class="nv">router</span><span class="p">:</span> <span class="kt">Router</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">helloController</span> <span class="o">=</span> <span class="kt">HelloController</span><span class="p">()</span>
    <span class="n">router</span><span class="o">.</span><span class="nf">get</span><span class="p">(</span><span class="s">"hello"</span><span class="p">,</span> <span class="nv">use</span><span class="p">:</span> <span class="n">helloController</span><span class="o">.</span><span class="n">greet</span><span class="p">)</span>
    <span class="n">router</span><span class="o">.</span><span class="nf">post</span><span class="p">(</span><span class="s">"hello"</span><span class="p">,</span> <span class="nv">use</span><span class="p">:</span> <span class="n">helloController</span><span class="o">.</span><span class="n">create</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>If you want to use Vapor to make websites instead of API, you can use <strong>Leaf</strong>. It’s a templating language, inspired by Swift syntax, that you can use to generate dynamic HTML pages.</li>
</ul>

<h3 id="useful-links">Useful links</h3>

<ul>
  <li><a href="https://docs.vapor.codes/3.0/">Documentation</a> &amp; <a href="https://api.vapor.codes">Guide</a></li>
  <li><a href="http://discord.gg/BnXmVGA">Official Vapor Discord</a></li>
  <li><a href="https://github.com/apple/swift-nio">SwiftNIO GitHub</a></li>
</ul>

  </div><a class="u-url" href="/swift%20server/2018/12/28/vapor.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Jonathan Seguin</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Jonathan Seguin</li><li><a class="u-email" href="mailto:djo.seguin@gmail.com">djo.seguin@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/jonseguin"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jonseguin</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>A blog about Swift and iOS development.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
